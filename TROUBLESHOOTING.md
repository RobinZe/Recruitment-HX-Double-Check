# 邮件发送问题排查指南

## Vercel部署环境下的邮件发送问题

在Vercel部署环境下，邮件发送可能会遇到一些特殊的问题，以下是排查步骤：

### 1. 检查环境变量配置

确保在Vercel项目设置中正确配置了以下环境变量：

- `MAIL_USERNAME`: 您的163邮箱地址
- `MAIL_PASSWORD`: 您的163邮箱授权码（不是登录密码）
- `TARGET_EMAIL`: 接收简历的目标邮箱地址

在Vercel控制台中，进入项目 -> Settings -> Environment Variables，添加或更新这些变量。

### 2. 查看Vercel日志

部署后，可以在Vercel控制台中查看函数执行日志：

1. 进入项目
2. 点击最新的部署
3. 点击 "Functions" 标签
4. 查找 `/api/upload.js` 函数的日志

日志中会包含详细的错误信息，帮助定位问题。

### 3. 常见问题及解决方案

#### 认证失败 (EAUTH)

- 检查邮箱账号和授权码是否正确
- 确认163邮箱已开启SMTP服务
- 尝试在163邮箱设置中重新生成授权码

#### 连接超时 (ETIMEDOUT)

- Vercel的无服务器函数有执行时间限制，默认为10秒
- 考虑使用其他邮件服务提供商，如SendGrid、Mailgun等，它们提供API接口，通常更适合无服务器环境

#### 网络连接问题 (ESOCKET)

- Vercel的某些区域可能对SMTP连接有限制
- 尝试使用不同的SMTP端口（587代替465）
- 考虑使用第三方邮件服务API

### 4. 本地测试

在部署到Vercel之前，可以在本地测试邮件发送功能：

```bash
node test-email.js
```

如果本地测试成功但Vercel部署失败，很可能是Vercel环境的特殊限制导致的。

### 5. 替代方案

如果在Vercel环境中无法解决SMTP邮件发送问题，可以考虑以下替代方案：

1. 使用第三方邮件服务API：
   - SendGrid
   - Mailgun
   - Amazon SES

2. 使用Vercel集成的服务：
   - Vercel提供了与多种第三方服务的集成
   - 在Vercel控制台的Integrations部分查看可用选项

3. 分离邮件发送功能：
   - 将文件上传和邮件发送功能分离
   - 使用专门的服务器或云函数处理邮件发送

### 6. 更新日志记录

为了更好地排查问题，已经增强了应用中的日志记录功能：

- 添加了更详细的错误信息记录
- 针对特定错误类型提供了更具体的日志
- 增加了环境变量检查日志

查看这些日志可以帮助您更准确地定位问题所在。